@page
@model DevBin.Pages.PasteModel
@using Humanizer
@{
    ViewData["Title"] = Model.Paste.Title ?? Model.Paste.Code;
    var paste = Model.Paste;

    var isAuthor = paste.AuthorId != null && HttpContext.User.Identity.IsAuthenticated && HttpContext.User.Identity.Name == paste.Author.Email;
}

<div class="row justify-content-between my-2">
    <h6 class="m-0">By @(paste.Author?.Username ?? "Guest")</h6>

    <div class="col-9 col-sm-8">
        @if (paste.ExposureId == 4) // Encrypted
        {
            <i class="fas fa-lock d-inline"></i>
        }
        <h3 class="fs-4 d-inline">@paste.Title</h3>
        <div class="pt-2">
            <span id="paste-syntax" class="badge rounded-pill bg-light text-dark d-inline">@paste.Syntax.Pretty</span>
            <span class="text-muted d-inline ms-2">
                <i class="fas fa-eye"></i> @paste.Views
            </span>
            <span class="text-muted d-inline ms-2">
                <i class="fas fa-clock"></i> @paste.Datetime.Humanize()
            </span>
            @if (paste.UpdateDatetime.HasValue)
            {
                <span class="text-muted d-inline ms-2">
                    <i class="fas fa-edit"></i> @paste.UpdateDatetime.Humanize()
                </span>
            }
        </div>
    </div>

    <div class="col-3 col-sm-4">
        <div class="row">
            <div class="col-6">
                <a href="/raw/@paste.Code" role="button" class="form-control btn btn-sm btn-outline-light"><i class="fas fa-code"></i> Raw Paste</a>
                @if (isAuthor)
                {
                    @if (paste.Exposure.AllowEdit)
                    {
                        <a href="/Edit/@paste.Code" role="button" type="submit" class="form-control btn btn-sm btn-outline-light mt-2"><i class="fas fa-edit"></i> Edit Paste</a>
                    }
                    else
                    {
                        <button class="form-control btn btn-sm btn-outline-light mt-2 disabled" disabled><i class="fas fa-edit"></i> Edit Paste</button>
                    }
                }
            </div>
            <div class="col-6">
                <a href="/?clone=@paste.Code" role="button" type="submit" class="form-control btn btn-sm btn-outline-light"><i class="fas fa-plus"></i> Clone Paste</a>
                @if (isAuthor)
                {
                    <a href="/?delete=@paste.Code" role="button" type="submit" class="form-control btn btn-sm btn-outline-danger mt-2" onclick="return confirm('Are you sure you want to delete this paste?')"><i class="fas fa-trash-alt"></i> Delete Paste</a>
                }
            </div>
        </div>
    </div>

</div>
<div id="paste-content" name="paste-input" class="my-2 form-control bg-dark text-light font-monospace codeblock outline-dark @(paste.ExposureId == 4 ? "locked" : "")">@(paste.ExposureId == 4 ? Html.Raw(paste.Content) : paste.Content)</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script src="~/js/paste.js"></script>
}
